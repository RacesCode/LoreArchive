{{ $characterFile := "content/notes/characters.md" }}
{{ $characterNames := readFile $characterFile | split "\n" }}

<table>
  <thead>
    <tr>
      <th>Character Name</th>
      <th>Files</th>
    </tr>
  </thead>
  <tbody>
    {{ range $characterNames }}
      {{ $character := trim . " \t" }}
      {{ $sanitizedName := printf "<script>document.write(sanitizeName('%s'));</script>" $character | safeJS }}
      {{ $sanitizedName = delimit (slice $sanitizedName) "" }}

      <tr>
        <td>{{ $character }}</td>
        <td>
          {{ $characterFiles := dict }}
          {{ range where .Pages "Type" "!=" "!ignore" }}
            {{ $characterFiles.Add $sanitizedName (slice) }}
            {{ $characterFiles.Set $sanitizedName ($characterFiles.Get $sanitizedName | append .) }}
          {{ end }}
          {{ range $characterFiles.Get $sanitizedName }}
            <a href="{{ .RelPermalink }}">{{ .Title }}</a><br>
          {{ end }}
        </td>
      </tr>
    {{ end }}
  </tbody>
</table>

<script src="/js/sanitizeNames.js"></script>